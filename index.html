<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sTEArdew Valley Planificador</title>
    <style>
        :root { --farm-green: #3a2e7d; --accent-gold: #ffd700; --special-purple: #801eaa; --collect-brown: #5d4037; --pierre-blue: #1976d2; }
        
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background-image: url('https://raw.githubusercontent.com/Grandunks/Stardew/main/Imagenes/fondo.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            margin: 0;
            padding: 20px; 
            color: #333; 
        }

        .container { 
            max-width: 1400px; 
            margin: auto; 
            background: rgba(31, 29, 29, 0); 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            backdrop-filter: blur(4px);
        }

        h1 { color: var(--farm-green); text-align: center; border-bottom: 3px solid var(--farm-green); padding-bottom: 10px; text-shadow: 1px 1px 2px white; }
        
        .controles { margin: 25px 0; display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; align-items: center; background: rgba(240, 237, 237, 0.63); padding: 20px; border-radius: 8px; border: 1px solid #ddd; }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-weight: bold; font-size: 0.9em; color: var(--farm-green); }
        
        input[type="text"], input[type="number"], select { padding: 8px; border-radius: 5px; border: 2px solid var(--farm-green); outline: none; background: white; }
        #buscarNombre { width: 200px; border-color: #1976d2; }
        
        .filtros-obtencion { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-bottom: 15px; width: 100%; }
        .btn-filtro { padding: 10px 18px; border-radius: 20px; border: 2px solid #ccc; background: white; cursor: pointer; font-weight: bold; transition: 0.3s; }
        
        .btn-filtro.active[data-cat="Todos"] { background: var(--farm-green); color: white; border-color: var(--farm-green); }
        .btn-filtro.active[data-cat="Compradas"] { background: var(--pierre-blue); color: white; border-color: var(--pierre-blue); }
        .btn-filtro.active[data-cat="Especial"] { background: var(--special-purple); color: white; border-color: var(--special-purple); }
        .btn-filtro.active[data-cat="Recogidas"] { background: var(--collect-brown); color: white; border-color: var(--collect-brown); }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: rgba(240, 237, 237, 0.63); border-radius: 10px; overflow: hidden; }
        th { background-color: var(--farm-green); color: white; padding: 15px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #ddd; vertical-align: middle; }
        tr:hover { background-color: #4e446b4d; }
        
        .crop-info { display: flex; align-items: center; gap: 15px; }
        .crop-icon { width: 32px; height: 32px; object-fit: contain; image-rendering: pixelated; }
        
        .gpd-badge { background: #e0e0e0; padding: 5px 10px; border-radius: 15px; font-weight: bold; color: #333; }
        .profit-badge { background: #c8e6c9; padding: 5px 10px; border-radius: 15px; font-weight: bold; color: #1b5e20; }
        .gold-badge { background: var(--accent-gold); padding: 5px 10px; border-radius: 15px; font-weight: bold; color: #5d4037; }
        .inversion-badge { background: #ffcdd2; padding: 5px 10px; border-radius: 15px; font-weight: bold; color: #b71c1c; }
        .cosecha-count { font-weight: bold; color: #1565c0; text-align: center; }
        .desc { font-size: 0.85em; color: #000000; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h1>Planificador de Cosechas para TEAS</h1>
    
    <div class="controles">
        <div class="filtros-obtencion" id="contenedorFiltros">
            <button class="btn-filtro active" data-cat="Todos" onclick="toggleFiltro('Todos')">Todos los Cultivos</button>
            <button class="btn-filtro" data-cat="Compradas" onclick="toggleFiltro('Compradas')">Compradas (Oro)</button>
            <button class="btn-filtro" data-cat="Especial" onclick="toggleFiltro('Especial')">Especial (Festivales/Isla)</button>
            <button class="btn-filtro" data-cat="Recogidas" onclick="toggleFiltro('Recogidas')">Recogidas/Encontradas</button>
        </div>

        <div class="control-group">
            <label>Buscar Cultivo:</label>
            <input type="text" id="buscarNombre" placeholder="Ej: Fresa..." oninput="actualizarTabla()">
        </div>

        <div class="control-group">
            <label>Ubicación / Temporada:</label>
            <select id="selectTemporada" onchange="actualizarTabla()">
                <option value="Primavera">Primavera</option>
                <option value="Verano">Verano</option>
                <option value="Otoño">Otoño</option>
                <option value="Invernadero">Invernadero / Isla Jengibre</option>
            </select>
        </div>

        <div class="control-group">
            <label>Fertilizante:</label>
            <select id="selectAcelerador" onchange="actualizarTabla()">
                <option value="0">Ninguno</option>
                <option value="0.10">Acelerador básico (100o)</option>
                <option value="0.25">Acelerador de lujo (150o)</option>
                <option value="0.35">Hipersuministro (Creacion)</option>
            </select>
        </div>

        <div class="control-group">
            <label>Cantidad:</label>
            <input type="number" id="inputCantidad" value="1" min="1" oninput="actualizarTabla()">
        </div>

        <div class="control-group" style="flex-direction: row; align-items: center; gap: 10px; padding-top: 20px;">
            <input type="checkbox" id="checkAgricultor" onchange="actualizarTabla()">
            <label for="checkAgricultor">Agricultor (+10% crecc.)</label>
        </div>

        <div class="control-group" style="flex-direction: row; align-items: center; gap: 10px; padding-top: 20px;">
            <input type="checkbox" id="checkLabrador" onchange="actualizarTabla()">
            <label for="checkLabrador">Labrador (+10% venta)</label>
        </div>
    </div>

    <table id="tablaCultivos">
        <thead>
            <tr>
                <th>Cultivo</th>
                <th>Cosechas</th>
                <th>Inversión</th>
                <th>Oro por dia</th>
                <th>Oro Total fin de mes</th>
                <th>Profit</th>
                <th>Obtención</th>
            </tr>
        </thead>
        <tbody id="cuerpoTabla"></tbody>
    </table>
</div>

<script>
    const data = {
        "cultivos": [
            // PRIMAVERA
            { "nombre": "Ajo", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 4, "rebrote": false, "precio_semilla": 40, "precio_venta": 60, "descripcion": "Pierre (Año 2)", "tipo": "Compradas" },
            { "nombre": "Allium azul", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 7, "rebrote": false, "precio_semilla": 30, "precio_venta": 50, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Arroz sin moler", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 8, "rebrote": false, "precio_semilla": 40, "precio_venta": 30, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Chirivia", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 4, "rebrote": false, "precio_semilla": 20, "precio_venta": 35, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Col rizada", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 6, "rebrote": false, "precio_semilla": 70, "precio_venta": 110, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Coliflor", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 12, "rebrote": false, "precio_semilla": 80, "precio_venta": 175, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Fresa (Día 1)", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 8, "rebrote": true, "dias_rebrote": 4, "precio_semilla": 100, "precio_venta": 120, "dia_siembra": 1, "descripcion": "Año anterior", "tipo": "Especial" },
            { "nombre": "Fresa (Día 13)", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 8, "rebrote": true, "dias_rebrote": 4, "precio_semilla": 100, "precio_venta": 120, "dia_siembra": 13, "descripcion": "Festival Huevo", "tipo": "Especial" },
            { "nombre": "Judia verde", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 10, "rebrote": true, "dias_rebrote": 3, "precio_semilla": 60, "precio_venta": 40, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Patata", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 6, "rebrote": false, "precio_semilla": 50, "precio_venta": 80, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Ruibarbo", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 13, "rebrote": false, "precio_semilla": 100, "precio_venta": 220, "descripcion": "Oasis", "tipo": "Compradas" },
            { "nombre": "Tulipan", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 6, "rebrote": false, "precio_semilla": 20, "precio_venta": 30, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Zanahoria", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 3, "rebrote": false, "precio_semilla": 0, "precio_venta": 35, "descripcion": "Cavando", "tipo": "Recogidas" },
            
            // VERANO
            { "nombre": "Amapola", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 7, "rebrote": false, "precio_semilla": 100, "precio_venta": 140, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Arandano", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 13, "rebrote": true, "dias_rebrote": 4, "multiplicador": 3, "precio_semilla": 80, "precio_venta": 50, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Calabaza amarilla", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 6, "rebrote": true, "dias_rebrote": 3, "precio_semilla": 0, "precio_venta": 45, "descripcion": "Encontrada", "tipo": "Recogidas" },
            { "nombre": "Carambola", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 13, "rebrote": false, "precio_semilla": 400, "precio_venta": 750, "descripcion": "Oasis", "tipo": "Compradas" },
            { "nombre": "Chile", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 5, "rebrote": true, "dias_rebrote": 3, "precio_semilla": 40, "precio_venta": 40, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Girasol", "temporada": ["Verano","Otoño","Invernadero"], "dias_crecimiento": 8, "rebrote": false, "precio_semilla": 125, "precio_venta": 80, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Lentejuela de verano", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 8, "rebrote": false, "precio_semilla": 50, "precio_venta": 90, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Lombarda", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 9, "rebrote": false, "precio_semilla": 100, "precio_venta": 260, "descripcion": "Año 2", "tipo": "Compradas" },
            { "nombre": "Lupulo", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 11, "rebrote": true, "dias_rebrote": 1, "precio_semilla": 60, "precio_venta": 25, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Maiz", "temporada": ["Verano","Otoño","Invernadero"], "dias_crecimiento": 14, "rebrote": true, "dias_rebrote": 4, "precio_semilla": 150, "precio_venta": 50, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Melon", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 12, "rebrote": false, "precio_semilla": 80, "precio_venta": 250, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Rabano", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 6, "rebrote": false, "precio_semilla": 40, "precio_venta": 90, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Tomate", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 11, "rebrote": true, "dias_rebrote": 4, "precio_semilla": 50, "precio_venta": 60, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Trigo", "temporada": ["Verano","Otoño","Invernadero"], "dias_crecimiento": 4, "rebrote": false, "precio_semilla": 10, "precio_venta": 25, "descripcion": "Pierre", "tipo": "Compradas" },

            // OTOÑO
            { "nombre": "Alcachofa", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 8, "rebrote": false, "precio_semilla": 30, "precio_venta": 160, "descripcion": "Año 2", "tipo": "Compradas" },
            { "nombre": "Amaranto", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 7, "rebrote": false, "precio_semilla": 70, "precio_venta": 150, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Berenjena", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 5, "rebrote": true, "dias_rebrote": 5, "precio_semilla": 20, "precio_venta": 60, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Brocoli", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 8, "rebrote": false, "precio_semilla": 0, "precio_venta": 70, "descripcion": "Encontrado", "tipo": "Recogidas" },
            { "nombre": "Calabaza", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 13, "rebrote": false, "precio_semilla": 100, "precio_venta": 320, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Col china", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 4, "rebrote": false, "precio_semilla": 50, "precio_venta": 80, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Grosella", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 7, "rebrote": true, "dias_rebrote": 5, "multiplicador": 2, "precio_semilla": 240, "precio_venta": 75, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Ñame", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 10, "rebrote": false, "precio_semilla": 60, "precio_venta": 160, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Remolacha", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 6, "rebrote": false, "precio_semilla": 20, "precio_venta": 100, "descripcion": "Oasis", "tipo": "Compradas" },
            { "nombre": "Rosa hada", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 12, "rebrote": false, "precio_semilla": 200, "precio_venta": 290, "descripcion": "Pierre", "tipo": "Compradas" },
            { "nombre": "Uva", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 10, "rebrote": true, "dias_rebrote": 3, "precio_semilla": 60, "precio_venta": 80, "descripcion": "Pierre", "tipo": "Compradas" },

            // ESPECIALES
            { "nombre": "Grano de cafe", "temporada": ["Primavera","Verano","Invernadero"], "dias_crecimiento": 10, "rebrote": true, "dias_rebrote": 2, "precio_semilla": 2500, "precio_venta": 15, "multiplicador": 4, "descripcion": "Carro", "tipo": "Compradas" },
            { "nombre": "Fruto de taro", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 10, "rebrote": false, "precio_semilla": 0, "precio_venta": 100, "descripcion": "Isla", "tipo": "Especial" },
            { "nombre": "Piña", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 14, "rebrote": true, "dias_rebrote": 7, "precio_semilla": 0, "precio_venta": 300, "descripcion": "Isla", "tipo": "Especial" },
            { "nombre": "Higo chumbo", "temporada": ["Invernadero"], "dias_crecimiento": 12, "rebrote": true, "dias_rebrote": 3, "precio_semilla": 150, "precio_venta": 75, "descripcion": "Oasis", "tipo": "Compradas" },
            { "nombre": "Fruta milenaria", "temporada": ["Primavera","Verano","Otoño","Invernadero"], "dias_crecimiento": 28, "rebrote": true, "dias_rebrote": 7, "precio_semilla": 0, "precio_venta": 550, "descripcion": "Especial", "tipo": "Especial" }
        ]
    };

    let categoriasActivas = ["Todos"];

    function toggleFiltro(cat) {
        const btns = document.querySelectorAll('.btn-filtro');
        
        if (cat === "Todos") {
            categoriasActivas = ["Todos"];
            btns.forEach(b => b.classList.remove('active'));
            document.querySelector('[data-cat="Todos"]').classList.add('active');
        } else {
            // Quitar "Todos" si seleccionamos una categoría específica
            categoriasActivas = categoriasActivas.filter(c => c !== "Todos");
            document.querySelector('[data-cat="Todos"]').classList.remove('active');

            if (categoriasActivas.includes(cat)) {
                categoriasActivas = categoriasActivas.filter(c => c !== cat);
                document.querySelector(`[data-cat="${cat}"]`).classList.remove('active');
            } else {
                categoriasActivas.push(cat);
                document.querySelector(`[data-cat="${cat}"]`).classList.add('active');
            }

            // Si no queda nada activo, volver a Todos
            if (categoriasActivas.length === 0) {
                categoriasActivas = ["Todos"];
                document.querySelector('[data-cat="Todos"]').classList.add('active');
            }
        }
        actualizarTabla();
    }

    function getIconUrl(nombre) {
        let baseName = nombre.split(' (')[0];
        let fileName = encodeURIComponent(baseName);
        return `https://raw.githubusercontent.com/Grandunks/Stardew/main/Imagenes/${fileName}.png`;
    }

    function calcularStats(c, bonoAcelerador, tieneAgricultor, tieneLabrador, cantidad) {
        let diaInicio = c.dia_siembra || 1;
        let diasDisponibles = 28 - diaInicio;
        let bonoTotal = parseFloat(bonoAcelerador) + (tieneAgricultor ? 0.10 : 0);
        let diasCrecimientoEfectivo = Math.max(1, Math.floor(c.dias_crecimiento * (1 - bonoTotal)));
        let precioVentaEfectivo = c.precio_venta * (tieneLabrador ? 1.1 : 1);
        let costoFertilizante = bonoAcelerador === "0.10" ? 100 : (bonoAcelerador === "0.25" ? 150 : 0);

        let maxCosechas = 0;
        let oroBrutoPorPlanta = 0;
        let inversionPorPlanta = 0;

        if (c.rebrote){
            maxCosechas = diasDisponibles < diasCrecimientoEfectivo ? 0 : 1 + Math.floor((diasDisponibles - diasCrecimientoEfectivo) / c.dias_rebrote);
            oroBrutoPorPlanta = maxCosechas * precioVentaEfectivo * (c.multiplicador || 1);
            inversionPorPlanta = c.precio_semilla + costoFertilizante;
        } else {
            maxCosechas = Math.floor(diasDisponibles / diasCrecimientoEfectivo);
            oroBrutoPorPlanta = maxCosechas * precioVentaEfectivo * (c.multiplicador || 1);
            inversionPorPlanta = (c.precio_semilla * maxCosechas) + costoFertilizante;
        }

        let profitPlanta = oroBrutoPorPlanta - inversionPorPlanta;
        return {
            cosechas: maxCosechas,
            gpd: (profitPlanta / 28).toFixed(2),
            oroBrutoTotal: oroBrutoPorPlanta * cantidad,
            profitTotal: profitPlanta * cantidad,
            inversionTotal: inversionPorPlanta * cantidad
        };
    }

    function actualizarTabla() {
        const busqueda = document.getElementById('buscarNombre').value.toLowerCase();
        const filtroTemporada = document.getElementById('selectTemporada').value;
        const acelerador = document.getElementById('selectAcelerador').value;
        const agricultor = document.getElementById('checkAgricultor').checked;
        const labrador = document.getElementById('checkLabrador').checked;
        const cantidad = parseInt(document.getElementById('inputCantidad').value) || 1;
        const cuerpo = document.getElementById('cuerpoTabla');
        
        let filtrados = data.cultivos.filter(c => 
            c.temporada.some(t => t.toLowerCase().includes(filtroTemporada.toLowerCase().split(' ')[0]))
        );

        // Lógica de Unión de Categorías
        if (!categoriasActivas.includes("Todos")) {
            filtrados = filtrados.filter(c => categoriasActivas.includes(c.tipo));
        }

        if(busqueda) {
            filtrados = filtrados.filter(c => c.nombre.toLowerCase().includes(busqueda));
        }

        let calculados = filtrados.map(c => {
            const stats = calcularStats(c, acelerador, agricultor, labrador, cantidad);
            return { ...c, ...stats };
        });

        calculados.sort((a, b) => b.profitTotal - a.profitTotal);

        cuerpo.innerHTML = "";
        calculados.forEach(c => {
            cuerpo.innerHTML += `
                <tr>
                    <td>
                        <div class="crop-info">
                            <img class="crop-icon" src="${getIconUrl(c.nombre)}" alt="${c.nombre}" onerror="this.style.visibility='hidden'">
                            <strong>${c.nombre}</strong>
                        </div>
                    </td>
                    <td class="cosecha-count">${c.cosechas}</td>
                    <td><span class="inversion-badge">$ ${c.inversionTotal.toFixed(0)}</span></td>
                    <td><span class="gpd-badge">$ ${c.gpd}</span></td>
                    <td><span class="gold-badge">$ ${c.oroBrutoTotal.toFixed(0)}</span></td>
                    <td><span class="profit-badge">$ ${c.profitTotal.toFixed(0)}</span></td>
                    <td class="desc">${c.descripcion}</td>
                </tr>`;
        });
    }

    actualizarTabla();
</script>

</body>
</html>