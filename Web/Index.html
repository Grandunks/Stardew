<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stardew Profit - Esteban</title>
    <style>
        :root { --farm-green: #2e7d32; --accent-gold: #ffd700; }
        body { font-family: 'Segoe UI', sans-serif; background-color: #e8f5e9; padding: 20px; color: #333; }
        .container { max-width: 1400px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { color: var(--farm-green); text-align: center; border-bottom: 3px solid var(--farm-green); padding-bottom: 10px; }
        
        .controles { margin: 25px 0; display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; align-items: center; background: #f9f9f9; padding: 20px; border-radius: 8px; border: 1px solid #ddd; }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-weight: bold; font-size: 0.9em; color: var(--farm-green); }
        
        input[type="text"], input[type="number"], select { padding: 8px; border-radius: 5px; border: 2px solid var(--farm-green); outline: none; }
        #buscarNombre { width: 250px; border-color: #1976d2; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background-color: var(--farm-green); color: white; padding: 15px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #ddd; vertical-align: middle; }
        tr:hover { background-color: #f1f8e9; }
        
        .crop-info { display: flex; align-items: center; gap: 15px; }
        .crop-icon { width: 32px; height: 32px; object-fit: contain; image-rendering: pixelated; }
        
        .gpd-badge { background: #e0e0e0; padding: 5px 10px; border-radius: 15px; font-weight: bold; color: #333; }
        .profit-badge { background: #c8e6c9; padding: 5px 10px; border-radius: 15px; font-weight: bold; color: #1b5e20; }
        .gold-badge { background: var(--accent-gold); padding: 5px 10px; border-radius: 15px; font-weight: bold; color: #5d4037; }
        .inversion-badge { background: #ffcdd2; padding: 5px 10px; border-radius: 15px; font-weight: bold; color: #b71c1c; }
        .cosecha-count { font-weight: bold; color: #1565c0; text-align: center; }
        .desc { font-size: 0.85em; color: #666; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h1>Planificador Maestro de Cosechas</h1>
    
    <div class="controles">
        <div class="control-group">
            <label>Buscar Cultivo:</label>
            <input type="text" id="buscarNombre" placeholder="Ej: Fresa..." oninput="actualizarTabla()">
        </div>

        <div class="control-group">
            <label>Ubicación / Temporada:</label>
            <select id="selectTemporada" onchange="actualizarTabla()">
                <option value="Primavera">Primavera</option>
                <option value="Verano">Verano</option>
                <option value="Otoño">Otoño</option>
                <option value="Invernadero">Invernadero / Isla Jengibre</option>
            </select>
        </div>

        <div class="control-group">
            <label>Fertilizante:</label>
            <select id="selectAcelerador" onchange="actualizarTabla()">
                <option value="0">Ninguno</option>
                <option value="0.10">Acelerador básico (100o)</option>
                <option value="0.25">Acelerador de lujo (150o)</option>
                <option value="0.35">Hipersuministro (Creacion)</option>
            </select>
        </div>

        <div class="control-group">
            <label>Cantidad:</label>
            <input type="number" id="inputCantidad" value="1" min="1" oninput="actualizarTabla()">
        </div>

        <div class="control-group" style="flex-direction: row; align-items: center; gap: 10px; padding-top: 20px;">
            <input type="checkbox" id="checkAgricultor" onchange="actualizarTabla()">
            <label for="checkAgricultor">Agricultor (+10% crecc.)</label>
        </div>

        <div class="control-group" style="flex-direction: row; align-items: center; gap: 10px; padding-top: 20px;">
            <input type="checkbox" id="checkLabrador" onchange="actualizarTabla()">
            <label for="checkLabrador">Labrador (+10% venta)</label>
        </div>
    </div>

    <table id="tablaCultivos">
        <thead>
            <tr>
                <th>Cultivo</th>
                <th>Cosechas</th>
                <th>Inversión</th>
                <th>Oro por dia</th>
                <th>Oro Total fin de mes</th>
                <th>Profit</th>
                <th>Obtención</th>
            </tr>
        </thead>
        <tbody id="cuerpoTabla"></tbody>
    </table>
</div>

<script>
    const data = {
        "cultivos": [
            { "nombre": "Ajo", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 4, "rebrote": false, "precio_semilla": 40, "precio_venta": 60, "descripcion": "Pierre (Año 2)" },
            { "nombre": "Allium azul", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 7, "rebrote": false, "precio_semilla": 30, "precio_venta": 50, "descripcion": "Pierre" },
            { "nombre": "Arroz sin moler", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 8, "rebrote": false, "precio_semilla": 40, "precio_venta": 30, "descripcion": "Pierre" },
            { "nombre": "Chirivia", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 4, "rebrote": false, "precio_semilla": 20, "precio_venta": 35, "descripcion": "Pierre" },
            { "nombre": "Col rizada", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 6, "rebrote": false, "precio_semilla": 70, "precio_venta": 110, "descripcion": "Pierre" },
            { "nombre": "Coliflor", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 12, "rebrote": false, "precio_semilla": 80, "precio_venta": 175, "descripcion": "Pierre" },
            { "nombre": "Fresa (Día 1)", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 8, "rebrote": true, "dias_rebrote": 4, "precio_semilla": 100, "precio_venta": 120, "dia_siembra": 1, "descripcion": "Año anterior" },
            { "nombre": "Fresa (Día 13)", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 8, "rebrote": true, "dias_rebrote": 4, "precio_semilla": 100, "precio_venta": 120, "dia_siembra": 13, "descripcion": "Festival Huevo" },
            { "nombre": "Judia verde", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 10, "rebrote": true, "dias_rebrote": 3, "precio_semilla": 60, "precio_venta": 40, "descripcion": "Pierre" },
            { "nombre": "Patata", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 6, "rebrote": false, "precio_semilla": 50, "precio_venta": 80, "descripcion": "Pierre" },
            { "nombre": "Ruibarbo", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 13, "rebrote": false, "precio_semilla": 100, "precio_venta": 220, "descripcion": "Oasis" },
            { "nombre": "Tulipan", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 6, "rebrote": false, "precio_semilla": 20, "precio_venta": 30, "descripcion": "Pierre" },
            { "nombre": "Zanahoria", "temporada": ["Primavera","Invernadero"], "dias_crecimiento": 3, "rebrote": false, "precio_semilla": 0, "precio_venta": 35, "descripcion": "Cavando" },
            { "nombre": "Amapola", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 7, "rebrote": false, "precio_semilla": 100, "precio_venta": 140, "descripcion": "Pierre" },
            { "nombre": "Arandano", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 13, "rebrote": true, "dias_rebrote": 4, "multiplicador": 3, "precio_semilla": 80, "precio_venta": 50, "descripcion": "Pierre" },
            { "nombre": "Calabaza amarilla", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 6, "rebrote": true, "dias_rebrote": 3, "precio_semilla": 0, "precio_venta": 45, "descripcion": "Encontrada" },
            { "nombre": "Carambola", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 13, "rebrote": false, "precio_semilla": 400, "precio_venta": 750, "descripcion": "Oasis" },
            { "nombre": "Chile", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 5, "rebrote": true, "dias_rebrote": 3, "precio_semilla": 40, "precio_venta": 40, "descripcion": "Pierre" },
            { "nombre": "Girasol", "temporada": ["Verano","Otoño","Invernadero"], "dias_crecimiento": 8, "rebrote": false, "precio_semilla": 125, "precio_venta": 80, "descripcion": "Pierre" },
            { "nombre": "Lentejuela de verano", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 8, "rebrote": false, "precio_semilla": 50, "precio_venta": 90, "descripcion": "Pierre" },
            { "nombre": "Lombarda", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 9, "rebrote": false, "precio_semilla": 100, "precio_venta": 260, "descripcion": "Año 2" },
            { "nombre": "Lupulo", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 11, "rebrote": true, "dias_rebrote": 1, "precio_semilla": 60, "precio_venta": 25, "descripcion": "Pierre" },
            { "nombre": "Maiz", "temporada": ["Verano","Otoño","Invernadero"], "dias_crecimiento": 14, "rebrote": true, "dias_rebrote": 4, "precio_semilla": 150, "precio_venta": 50, "descripcion": "Pierre" },
            { "nombre": "Melon", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 12, "rebrote": false, "precio_semilla": 80, "precio_venta": 250, "descripcion": "Pierre" },
            { "nombre": "Rabano", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 6, "rebrote": false, "precio_semilla": 40, "precio_venta": 90, "descripcion": "Pierre" },
            { "nombre": "Tomate", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 11, "rebrote": true, "dias_rebrote": 4, "precio_semilla": 50, "precio_venta": 60, "descripcion": "Pierre" },
            { "nombre": "Trigo", "temporada": ["Verano","Otoño","Invernadero"], "dias_crecimiento": 4, "rebrote": false, "precio_semilla": 10, "precio_venta": 25, "descripcion": "Pierre" },
            { "nombre": "Alcachofa", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 8, "rebrote": false, "precio_semilla": 30, "precio_venta": 160, "descripcion": "Año 2" },
            { "nombre": "Amaranto", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 7, "rebrote": false, "precio_semilla": 70, "precio_venta": 150, "descripcion": "Pierre" },
            { "nombre": "Berenjena", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 5, "rebrote": true, "dias_rebrote": 5, "precio_semilla": 20, "precio_venta": 60, "descripcion": "Pierre" },
            { "nombre": "Brocoli", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 8, "rebrote": false, "precio_semilla": 0, "precio_venta": 70, "descripcion": "Encontrado" },
            { "nombre": "Calabaza", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 13, "rebrote": false, "precio_semilla": 100, "precio_venta": 320, "descripcion": "Pierre" },
            { "nombre": "Col china", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 4, "rebrote": false, "precio_semilla": 50, "precio_venta": 80, "descripcion": "Pierre" },
            { "nombre": "Grosella", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 7, "rebrote": true, "dias_rebrote": 5, "multiplicador": 2, "precio_semilla": 240, "precio_venta": 75, "descripcion": "Pierre" },
            { "nombre": "Ñame", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 10, "rebrote": false, "precio_semilla": 60, "precio_venta": 160, "descripcion": "Pierre" },
            { "nombre": "Remolacha", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 6, "rebrote": false, "precio_semilla": 20, "precio_venta": 100, "descripcion": "Oasis" },
            { "nombre": "Rosa hada", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 12, "rebrote": false, "precio_semilla": 200, "precio_venta": 290, "descripcion": "Pierre" },
            { "nombre": "Uva", "temporada": ["Otoño","Invernadero"], "dias_crecimiento": 10, "rebrote": true, "dias_rebrote": 3, "precio_semilla": 60, "precio_venta": 80, "descripcion": "Pierre" },
            { "nombre": "Grano de cafe", "temporada": ["Primavera","Verano","Invernadero"], "dias_crecimiento": 10, "rebrote": true, "dias_rebrote": 2, "precio_semilla": 2500, "precio_venta": 15, "multiplicador": 4, "descripcion": "Carro" },
            { "nombre": "Fruto de taro", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 10, "rebrote": false, "precio_semilla": 0, "precio_venta": 100, "descripcion": "Isla" },
            { "nombre": "Piña", "temporada": ["Verano","Invernadero"], "dias_crecimiento": 14, "rebrote": true, "dias_rebrote": 7, "precio_semilla": 0, "precio_venta": 300, "descripcion": "Isla" },
            { "nombre": "Higo chumbo", "temporada": ["Invernadero"], "dias_crecimiento": 12, "rebrote": true, "dias_rebrote": 3, "precio_semilla": 150, "precio_venta": 75, "descripcion": "Oasis" },
            { "nombre": "Fruta milenaria", "temporada": ["Primavera","Verano","Otoño","Invernadero"], "dias_crecimiento": 28, "rebrote": true, "dias_rebrote": 7, "precio_semilla": 0, "precio_venta": 550, "descripcion": "Especial" }
        ]
    };

    function getIconUrl(nombre) {
        // Obtenemos solo el nombre (sin los paréntesis del Día)
        let baseName = nombre.split(' (')[0];
        
        // encodeURIComponent convierte espacios en %20 para que GitHub lo entienda
        let fileName = encodeURIComponent(baseName);
        
        return `https://raw.githubusercontent.com/Grandunks/Stardew/main/Imagenes/${fileName}.png`;
    }

    function calcularStats(c, bonoAcelerador, tieneAgricultor, tieneLabrador, cantidad) {
        let diaInicio = c.dia_siembra || 1;
        let diasDisponibles = 28 - diaInicio;
        let bonoTotal = parseFloat(bonoAcelerador) + (tieneAgricultor ? 0.10 : 0);
        let diasCrecimientoEfectivo = Math.max(1, Math.floor(c.dias_crecimiento * (1 - bonoTotal)));
        let precioVentaEfectivo = c.precio_venta * (tieneLabrador ? 1.1 : 1);
        let costoFertilizante = bonoAcelerador === "0.10" ? 100 : (bonoAcelerador === "0.25" ? 150 : 0);

        let maxCosechas = 0;
        let oroBrutoPorPlanta = 0;
        let inversionPorPlanta = 0;

        if (c.rebrote){
            maxCosechas = diasDisponibles < diasCrecimientoEfectivo ? 0 : 1 + Math.floor((diasDisponibles - diasCrecimientoEfectivo) / c.dias_rebrote);
            oroBrutoPorPlanta = maxCosechas * precioVentaEfectivo * (c.multiplicador || 1);
            inversionPorPlanta = c.precio_semilla + costoFertilizante;
        } else {
            maxCosechas = Math.floor(diasDisponibles / diasCrecimientoEfectivo);
            oroBrutoPorPlanta = maxCosechas * precioVentaEfectivo * (c.multiplicador || 1);
            inversionPorPlanta = (c.precio_semilla * maxCosechas) + costoFertilizante;
        }

        let profitPlanta = oroBrutoPorPlanta - inversionPorPlanta;
        return {
            cosechas: maxCosechas,
            gpd: (profitPlanta / 28).toFixed(2),
            oroBrutoTotal: oroBrutoPorPlanta * cantidad,
            profitTotal: profitPlanta * cantidad,
            inversionTotal: inversionPorPlanta * cantidad
        };
    }

    function actualizarTabla() {
        const busqueda = document.getElementById('buscarNombre').value.toLowerCase();
        const filtro = document.getElementById('selectTemporada').value;
        const acelerador = document.getElementById('selectAcelerador').value;
        const agricultor = document.getElementById('checkAgricultor').checked;
        const labrador = document.getElementById('checkLabrador').checked;
        const cantidad = parseInt(document.getElementById('inputCantidad').value) || 1;
        const cuerpo = document.getElementById('cuerpoTabla');
        
        // Primero filtramos por temporada
        let filtrados = data.cultivos.filter(c => 
            c.temporada.some(t => t.toLowerCase().includes(filtro.toLowerCase().split(' ')[0]))
        );

        // Luego filtramos por nombre si hay algo escrito en la barra de búsqueda
        if(busqueda) {
            filtrados = filtrados.filter(c => c.nombre.toLowerCase().includes(busqueda));
        }

        let calculados = filtrados.map(c => {
            const stats = calcularStats(c, acelerador, agricultor, labrador, cantidad);
            return { ...c, ...stats };
        });

        calculados.sort((a, b) => b.profitTotal - a.profitTotal);

        cuerpo.innerHTML = "";
        calculados.forEach(c => {
            cuerpo.innerHTML += `
                <tr>
                    <td>
                        <div class="crop-info">
                            <img class="crop-icon" src="${getIconUrl(c.nombre)}" alt="${c.nombre}" onerror="this.style.visibility='hidden'">
                            <strong>${c.nombre}</strong>
                        </div>
                    </td>
                    <td class="cosecha-count">${c.cosechas}</td>
                    <td><span class="inversion-badge">$ ${c.inversionTotal.toFixed(0)}</span></td>
                    <td><span class="gpd-badge">$ ${c.gpd}</span></td>
                    <td><span class="gold-badge">$ ${c.oroBrutoTotal.toFixed(0)}</span></td>
                    <td><span class="profit-badge">$ ${c.profitTotal.toFixed(0)}</span></td>
                    <td class="desc">${c.descripcion}</td>
                </tr>`;
        });
    }

    actualizarTabla();
</script>

</body>
</html>